<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Floating Words with Sentiment</title>
    <script src="https://cdn.jsdelivr.net/npm/p5@2.0.5/lib/p5.js"></script>
    <script src="https://unpkg.com/ml5@latest/dist/ml5.min.js"></script>
    <style>
            body {
                margin: 0;
                padding: 0;
                background: #f8f9fa;
                font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
                overflow: hidden;
            }

            #controls {
                position: absolute;
                bottom: 20px;
                left: 20px;
                z-index: 100;
                background: rgba(255, 255, 255, 0.9);
                padding: 12px 18px;
                border-radius: 25px;
/*                 box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); */
                backdrop-filter: blur(10px);
                font-size: 12px;
                color: #666;
            }

            #sentiment-info {
                position: absolute;
                top: 20px;
                right: 20px;
                z-index: 100;
                background: rgba(255, 255, 255, 0.9);
                padding: 12px 18px;
                border-radius: 15px;
/*                 box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); */
                backdrop-filter: blur(10px);
                font-size: 12px;
                color: #666;
                min-width: 150px;
            }

            #hormone-info {
                position: absolute;
                z-index: 200;
                background: rgba(255, 0.7);
      /*           background:
                    radial-gradient(circle at 20% 30%, rgba(255, 107, 107, 0.25) 0%, transparent 35%),
                    radial-gradient(circle at 70% 20%, rgba(74, 144, 226, 0.22) 0%, transparent 40%),
                    radial-gradient(circle at 80% 60%, rgba(255, 142, 83, 0.28) 0%, transparent 30%),
                    radial-gradient(circle at 30% 80%, rgba(196, 69, 105, 0.24) 0%, transparent 45%),
                    radial-gradient(circle at 60% 70%, rgba(26, 188, 156, 0.26) 0%, transparent 35%),
                    radial-gradient(circle at 10% 60%, rgba(155, 89, 182, 0.23) 0%, transparent 38%),
                    radial-gradient(circle at 90% 40%, rgba(241, 196, 15, 0.21) 0%, transparent 32%),
                    radial-gradient(circle at 45% 10%, rgba(46, 204, 113, 0.25) 0%, transparent 40%),
                    rgba(255, 255, 255, 0.92); */

              color: #333;
                padding: 40px;
                border-radius: 25px;
      /*           box-shadow:
                    0 25px 80px rgba(0, 0, 0, 0.15),
                    inset 0 1px 0 rgba(255, 255, 255, 0.9); */
                backdrop-filter: blur(20px);
                font-size: 18px;
                line-height: 1.6;
                opacity: 0;
                pointer-events: none;
                transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
                text-align: left;
                border: 1px solid rgba(255, 255, 255, 0.4);
                transform: scale(0.95);
            }

            #hormone-info.visible {
                opacity: 1;
                pointer-events: auto;
                transform: scale(1);
            }

            #hormone-info h3 {
                margin: 0 0 15px 0;
                color: #222;
                font-size: 22px;
                font-weight: 400;
                text-shadow: 0 1px 2px rgba(255, 255, 255, 0.8);
            }

            #hormone-info p {
                margin: 0;
                font-size: 16px;
                line-height: 1.6;
                color: #444;
                text-shadow: 0 1px 1px rgba(255, 255, 255, 0.6);
            }

            .sentiment-positive { color: #d73527; }
            .sentiment-negative { color: #4a90e2; }
            .sentiment-neutral { color: #666; }
    </style>
  </head>
  <body>
    <div id="controls">
      Press 'SPACE' for next sentence • Press 'R' to regenerate colors •
      Touch/Click anywhere for next sentence
    </div>

    <div id="sentiment-info">
      <div>Sentiment: <span id="sentiment-label">Analyzing...</span></div>
      <div>Score: <span id="sentiment-score">-</span></div>
      <div>Color Theme: <span id="color-theme">-</span></div>
    </div>

    <div id="hormone-info">
      <h3 id="hormone-name">Hormone</h3>
      <p id="hormone-description">Description</p>
    </div>

    <script>
      const poeticTexts = [
          "The Way You Laugh Makes Me Want To Be Funnier",
          "The Way You Listen Makes Me Want To Have Something To Say",
          "I Am A Collection Of Texts That I Never Sent",
          "I Am A Collection Of Things That I Never Told You",
          "I Vanish In The Pause Before Your First Word",
          "My Thoughts Have Thoughts About Having Thoughts",
          "I Am Getting Better At Being Here",
          "I Want To Know What You Think About At 3 AM",
          "I Am Both Too Much And Not Enough",
          "I Rehearse Being Spontaneous",
          "You Are The Comma In My Run-On Sentence",
          "I Live In The Space Between Wanting And Never Asking",
          "I Wonder What My Voice Sounds Like To You",
          "You Are Here and That Is Enough",
          "Adults Are Just Trying Not to Spill",
          "You Are Here and That Is Enough",
          "A Cloud Sat on My Head and I Let It",
          "We Are Both New Here Learning This Together",
          "Your Dreams Visit Me Before They Visit You",
          "I Keep My Feelings Folded in Small Pockets"
      ];

      let words = [];
      let currentSentenceIndex = 0;
      let canvas;
      let sentiment;
      let currentSentiment = null;
      let currentColorScheme = 'neutral';
      let modelLoaded = false;
      let hoveredWord = null;
      let sentenceBounds = { minX: 0, maxX: 0, minY: 0, maxY: 0 };

      // Hormone facts mapped to sentence themes
      const hormoneFacts = [
          { // "The Way You Laugh Makes Me Want To Be Funnier"
              hormone: "Oxytocin + Dopamine",
              description: "The 'love cocktail.' Oxytocin floods the maternal brain during skin-to-skin contact, while dopamine creates reward pathways that make caregiving addictive. Together, they hijack the pleasure system to prioritize infant needs over self-preservation."
          },
          { // "The Way You Listen Makes Me Want To Have Something To Say"
              hormone: "Prolactin + Cortisol",
              description: "The hypervigilance duo. Prolactin heightens auditory processing for infant cues while cortisol keeps mothers in a state of productive stress. This combination creates 'maternal radar' - the ability to hear a baby's cry through any noise."
          },
          { // "I Am A Collection Of Texts That I Never Sent"
              hormone: "Progesterone + GABA",
              description: "The silencing system. High progesterone during pregnancy enhances GABA activity, creating a natural tranquilizer effect. This neurochemical dampening protects the developing fetus from maternal stress but often leaves mothers feeling disconnected from their own thoughts."
          },
          { // "I Am A Collection Of Things That I Never Told You"
              hormone: "Estradiol + Serotonin",
              description: "The memory reorganizer. Estradiol surges create new neural pathways while serotonin fluctuations affect emotional recall. Maternal brains literally restructure to prioritize infant-related memories, sometimes at the cost of pre-pregnancy identity formation."
          },
          { // "I Vanish In The Pause Before Your First Word"
              hormone: "hCG + Thyroid Hormones",
              description: "The metabolic hijack. hCG redirects thyroid function to support fetal development, often leaving mothers in a state of cognitive suspension. This creates the 'pregnancy pause' - moments where maternal consciousness temporarily dissolves to preserve fetal resources."
          },
          { // "My Thoughts Have Thoughts About Having Thoughts"
              hormone: "Neurosteroids + Allopregnanolone",
              description: "The meta-cognitive amplifiers. These pregnancy-specific neurosteroids increase neural connectivity while creating recursive thought patterns. The maternal brain develops 'protective rumination' - constantly analyzing potential threats to offspring through multiple cognitive layers."
          },
          { // "I Am Getting Better At Being Here"
              hormone: "Relaxin + Endorphins",
              description: "The presence enhancers. Relaxin loosens physical boundaries while endorphins create a natural high during maternal bonding. This combination anchors mothers in the present moment, making 'now' feel more real and important than past or future concerns."
          },
          { // "I Want To Know What You Think About At 3 AM"
              hormone: "Melatonin Suppression + Prolactin",
              description: "The sleep sacrifice system. Prolactin actively suppresses melatonin production, keeping mothers alert during traditional sleep hours. This creates 'night consciousness' - a hyperaware state designed to monitor infant breathing and movements in darkness."
          },
          { // "I Am Both Too Much And Not Enough"
              hormone: "Progesterone Withdrawal + Estrogen Dominance",
              description: "The postpartum paradox. Rapid hormonal shifts after birth create contradictory neurochemical signals. The brain simultaneously craves more stimulation (estrogen) while becoming overwhelmed by existing input (progesterone crash), creating impossible emotional standards."
          },
          { // "I Rehearse Being Spontaneous"
              hormone: "Adrenaline + Acetylcholine",
              description: "The anticipatory alertness system. Chronic low-level adrenaline paired with acetylcholine creates 'predictive parenting' - constantly rehearsing responses to potential infant needs. Spontaneity becomes a calculated performance within carefully prepared parameters."
          },
          { // "You Are The Comma In My Run-On Sentence"
              hormone: "Vasopressin + Oxytocin",
              description: "The attachment restructuring team. Vasopressin creates territorial bonding while oxytocin builds emotional connection. Together, they rewrite the maternal narrative structure, making the child the central punctuation that gives meaning to all other life experiences."
          },
          { // "I Live In The Space Between Wanting And Never Asking"
              hormone: "Leptin Resistance + Ghrelin Suppression",
              description: "The self-denial programming. Maternal brains develop resistance to satiety signals (leptin) while suppressing hunger cues (ghrelin) when resources are scarce. This creates 'sacrificial appetite' - always ensuring others are fed before acknowledging personal needs."
          },
          { // "I Wonder What My Voice Sounds Like To You"
              hormone: "Estrogen + Vocal Cord Steroids",
              description: "The communication transformer. Hormonal changes literally alter vocal cord thickness and resonance. Mothers unconsciously modulate their voice frequency to match infant auditory preferences, often losing recognition of their own authentic speaking tone."
          },
          { // "You Are Here and That Is Enough"
              hormone: "Endocannabinoids + Oxytocin",
              description: "The contentment cascade. The maternal brain produces natural cannabis-like compounds during bonding moments, enhanced by oxytocin release. This creates 'sufficient euphoria' - a biochemical state where simple presence feels like complete fulfillment."
          },
          { // "Adults Are Just Trying Not to Spill"
              hormone: "hCG + Insulin Resistance",
              description: "The coordination disruption. hCG alters glucose metabolism, creating temporary insulin resistance that affects fine motor control. 'Pregnancy clumsiness' is actually metabolic protection - the body prioritizes fetal glucose needs over maternal dexterity."
          },
          { // "You Are Here and That Is Enough" (duplicate)
              hormone: "Beta-Endorphins + Prolactin",
              description: "The reward simplification system. These hormones create powerful positive reinforcement for basic caregiving acts. Complex achievement needs are replaced by simple presence-based satisfaction, making 'enough' feel genuinely abundant rather than settling."
          },
          { // "A Cloud Sat on My Head and I Let It"
              hormone: "Allopregnanolone + GABA Enhancement",
              description: "The acceptance amplifier. This neurosteroid enhances GABA receptors, creating a state of passive receptivity. The maternal brain develops 'surrender capacity' - biochemically rewarding acceptance of circumstances rather than resistance or control attempts."
          },
          { // "We Are Both New Here Learning This Together"
              hormone: "BDNF + Neuroplasticity Factors",
              description: "The mutual adaptation protocol. Brain-derived neurotrophic factor surges during early motherhood, creating unprecedented neural flexibility. Both mother and infant brains literally grow new connections simultaneously, making learning a shared neurochemical experience."
          },
          { // "Your Dreams Visit Me Before They Visit You"
              hormone: "REM Suppression + Hypnagogic Hormones",
              description: "The dream sharing system. Maternal brains spend more time in light sleep stages while producing hypnagogic hormones that increase dream vividness. This creates 'predictive dreaming' - unconsciously processing potential infant needs before they manifest."
          },
          { // "I Keep My Feelings Folded in Small Pockets"
              hormone: "Cortisol Binding + Emotional Suppression",
              description: "The compartmentalization chemistry. Stress hormones become bound to specific proteins, creating 'emotional storage' rather than immediate processing. Maternal brains develop biochemical filing systems to preserve overwhelming feelings until safe processing time becomes available."
          }
      ];

      // Color schemes based on sentiment
      const colorSchemes = {
          positive: {
              colors: [
                  '#FF6B6B', '#FF8E53', '#FF6B9D', '#C44569',
                  '#F8B500', '#FFA726', '#FF7043', '#E57373',
                  '#FFB74D', '#FFCC02', '#FF5722', '#FF9800'
              ],
              name: 'Warm/Positive'
          },
          negative: {
              colors: [
                  '#4A90E2', '#5DADE2', '#3498DB', '#2980B9',
                  '#1ABC9C', '#16A085', '#48CAE4', '#219EBC',
                  '#023047', '#126782', '#8ECAE6', '#219EBC'
              ],
              name: 'Cool/Negative'
          },
          neutral: {
              colors: [
                  '#95A5A6', '#BDC3C7', '#7F8C8D', '#85929E',
                  '#A569BD', '#8E44AD', '#9B59B6', '#BB8FCE',
                  '#82E0AA', '#58D68D', '#F7DC6F', '#F4D03F'
              ],
              name: 'Neutral/Mixed'
          }
      };

      // Simple sentiment analysis as fallback
      function simpleSentimentAnalysis(text) {
          const positiveWords = ['love', 'happy', 'joy', 'wonderful', 'amazing', 'great', 'good', 'beautiful', 'fantastic', 'excellent', 'perfect', 'smile', 'laugh', 'hope', 'dream', 'light', 'bright', 'warm', 'peace', 'together', 'enough', 'better', 'here'];
          const negativeWords = ['sad', 'angry', 'hate', 'terrible', 'awful', 'bad', 'horrible', 'pain', 'hurt', 'dark', 'cold', 'alone', 'never', 'nothing', 'empty', 'lost', 'broken', 'fear', 'worry', 'anxious', 'vanish', 'pause', 'space', 'wanting', 'asking'];

          const words = text.toLowerCase().split(/\W+/);
          let positiveCount = 0;
          let negativeCount = 0;

          words.forEach(word => {
              if (positiveWords.includes(word)) positiveCount++;
              if (negativeWords.includes(word)) negativeCount++;
          });

          const total = positiveCount + negativeCount;
          if (total === 0) return { confidence: 0.5 }; // neutral

          const positiveRatio = positiveCount / total;
          return { confidence: positiveRatio };
      }

      function colorToRgba(color, alpha) {
          if (color.startsWith('rgb(')) {
              const values = color.match(/\d+/g);
              if (values && values.length >= 3) {
                  return `rgba(${values[0]}, ${values[1]}, ${values[2]}, ${alpha})`;
              }
          }

          if (color.startsWith('#')) {
              const r = parseInt(color.slice(1, 3), 16);
              const g = parseInt(color.slice(3, 5), 16);
              const b = parseInt(color.slice(5, 7), 16);
              return `rgba(${r}, ${g}, ${b}, ${alpha})`;
          }

          return color;
      }

      function getColorFromSentiment() {
          const scheme = colorSchemes[currentColorScheme];
          return scheme.colors[Math.floor(Math.random() * scheme.colors.length)];
      }

      function updateSentimentDisplay(sentimentResult) {
          const label = document.getElementById('sentiment-label');
          const score = document.getElementById('sentiment-score');
          const theme = document.getElementById('color-theme');

          if (sentimentResult) {
              const confidence = sentimentResult.confidence;
              const sentimentLabel = confidence > 0.6 ? 'Positive' : confidence < 0.4 ? 'Negative' : 'Neutral';

              label.textContent = sentimentLabel;
              label.className = `sentiment-${sentimentLabel.toLowerCase()}`;
              score.textContent = confidence.toFixed(3);
              theme.textContent = colorSchemes[currentColorScheme].name;
          }
      }

      function calculateSentenceBounds() {
          if (words.length === 0) return;

          sentenceBounds.minX = words[0].x;
          sentenceBounds.maxX = words[0].x;
          sentenceBounds.minY = words[0].y;
          sentenceBounds.maxY = words[0].y;

          for (let word of words) {
              sentenceBounds.minX = Math.min(sentenceBounds.minX, word.x - word.shapeWidth/2);
              sentenceBounds.maxX = Math.max(sentenceBounds.maxX, word.x + word.shapeWidth/2);
              sentenceBounds.minY = Math.min(sentenceBounds.minY, word.y - word.shapeHeight/2);
              sentenceBounds.maxY = Math.max(sentenceBounds.maxY, word.y + word.shapeHeight/2);
          }

          // Add padding around the sentence
          const padding = 60;
          sentenceBounds.minX -= padding;
          sentenceBounds.maxX += padding;
          sentenceBounds.minY -= padding;
          sentenceBounds.maxY += padding;
      }

      class WordShape {
          constructor(word, baseX, baseY, index) {
              this.word = word;
              this.baseX = baseX;
              this.baseY = baseY;
              this.x = baseX;
              this.y = baseY;
              this.index = index;

              // Very gentle movement parameters
              this.offsetX = 0;
              this.offsetY = 0;
              this.timeOffset = random(TWO_PI);
              this.speedMultiplier = random(0.8, 1.2);

              // Colors based on current sentiment
              this.color1 = getColorFromSentiment();
              this.color2 = getColorFromSentiment();
              // this.fontSize = random(28, 36);
            this.fontSize = 30;
              this.padding = 15;

              // Calculate word dimensions
              textSize(this.fontSize);
              this.wordWidth = textWidth(this.word);
              this.wordHeight = this.fontSize;

              // Shape dimensions with padding
              this.shapeWidth = this.wordWidth + this.padding * 2;
              this.shapeHeight = this.wordHeight + this.padding * 1.5;

              // Gentle pulsing
              this.pulseOffset = random(TWO_PI);
              this.rotation = random(-0.05, 0.05); // Very slight rotation
          }

          update() {
              // Very gentle floating motion - much smaller range
              this.timeOffset += 0.01 * this.speedMultiplier;
              this.offsetX = sin(this.timeOffset) * 8; // Reduced from larger values
              this.offsetY = cos(this.timeOffset * 1.3) * 6; // Reduced from larger values

              // Update position
              this.x = this.baseX + this.offsetX;
              this.y = this.baseY + this.offsetY;

              // Gentle pulsing
              this.pulseOffset += 0.008;
          }

          updateColors() {
              this.color1 = getColorFromSentiment();
              this.color2 = getColorFromSentiment();
          }

          display() {
              push();
              translate(this.x, this.y);
              rotate(this.rotation);

              // Create gradient with more white space in middle
              const gradientFill = drawingContext.createLinearGradient(
                  -this.shapeWidth/2, 0,  // Start from left side
                  this.shapeWidth/2, 0    // End at right side
              );

              // Left side - very gradual fade of color1
              gradientFill.addColorStop(0, colorToRgba(this.color1, 0.4));
              gradientFill.addColorStop(0.05, colorToRgba(this.color1, 0.35));
              gradientFill.addColorStop(0.1, colorToRgba(this.color1, 0.28));
              gradientFill.addColorStop(0.15, colorToRgba(this.color1, 0.22));
              gradientFill.addColorStop(0.2, colorToRgba(this.color1, 0.16));
              gradientFill.addColorStop(0.25, colorToRgba(this.color1, 0.12));
              gradientFill.addColorStop(0.3, colorToRgba(this.color1, 0.08));
              gradientFill.addColorStop(0.35, colorToRgba(this.color1, 0.05));
              gradientFill.addColorStop(0.4, colorToRgba(this.color1, 0.02));
              gradientFill.addColorStop(0.42, colorToRgba(this.color1, 0.01));

              // Wide transparent middle zone
              gradientFill.addColorStop(0.45, 'rgba(0,0,0,0)');
              gradientFill.addColorStop(0.55, 'rgba(0,0,0,0)');

              // Right side - very gradual fade of color2
              gradientFill.addColorStop(0.58, colorToRgba(this.color2, 0.01));
              gradientFill.addColorStop(0.6, colorToRgba(this.color2, 0.02));
              gradientFill.addColorStop(0.65, colorToRgba(this.color2, 0.05));
              gradientFill.addColorStop(0.7, colorToRgba(this.color2, 0.08));
              gradientFill.addColorStop(0.75, colorToRgba(this.color2, 0.12));
              gradientFill.addColorStop(0.8, colorToRgba(this.color2, 0.16));
              gradientFill.addColorStop(0.85, colorToRgba(this.color2, 0.22));
              gradientFill.addColorStop(0.9, colorToRgba(this.color2, 0.28));
              gradientFill.addColorStop(0.95, colorToRgba(this.color2, 0.35));
              gradientFill.addColorStop(1.0, colorToRgba(this.color2, 0.4));

              drawingContext.fillStyle = gradientFill;
              noStroke();

              // Gentle pulsing
              const pulseFactor = 1 + sin(this.pulseOffset) * 0.03;
              const currentWidth = this.shapeWidth * pulseFactor;
              const currentHeight = this.shapeHeight * pulseFactor;

              // Draw rounded rectangle background with bigger radius for rounder shape
              rect(-currentWidth/2, -currentHeight/2, currentWidth, currentHeight, currentHeight/2);

              // Draw the word
              fill(0, 0, 0, 180); // Semi-transparent black text
              noStroke();
              textAlign(CENTER, CENTER);
              textSize(this.fontSize);
              textStyle(NORMAL);
              text(this.word, 0, 0);

              pop();
          }
      }

      function analyzeSentimentAndCreateSentence(sentenceText) {
          let result;

          // Try ML5 sentiment analysis if available
          if (modelLoaded && sentiment && typeof sentiment.predict === 'function') {
              try {
                  sentiment.predict(sentenceText, (err, mlResult) => {
                      if (err) {
                          console.log('ML5 prediction error, using fallback:', err);
                          result = simpleSentimentAnalysis(sentenceText);
                      } else {
                          result = mlResult;
                      }
                      processSentimentResult(result, sentenceText);
                  });
                  return; // Exit early for async ML5 processing
              } catch (error) {
                  console.log('ML5 error, using fallback sentiment analysis:', error);
              }
          }

          // Fallback to simple sentiment analysis
          result = simpleSentimentAnalysis(sentenceText);
          processSentimentResult(result, sentenceText);
      }

      function processSentimentResult(result, sentenceText) {
          currentSentiment = result;

          // Determine color scheme based on sentiment
          if (result.confidence > 0.6) {
              currentColorScheme = 'positive';
          } else if (result.confidence < 0.4) {
              currentColorScheme = 'negative';
          } else {
              currentColorScheme = 'neutral';
          }

          updateSentimentDisplay(result);
          createSentence(sentenceText);
      }

      function createSentence(sentenceText) {
          words = [];
          const sentenceWords = sentenceText.split(' ');
          const maxWidth = width * 0.7; // 70% of window width

          // Calculate word widths and organize into lines
          textSize(32); // Average font size for calculation
          let lines = [];
          let currentLine = [];
          let currentLineWidth = 0;

          for (let word of sentenceWords) {
              const wordWidth = textWidth(word) + 30 + 20; // word width + padding + spacing

              // Check if adding this word would exceed max width
              if (currentLineWidth + wordWidth > maxWidth && currentLine.length > 0) {
                  // Start a new line
                  lines.push([...currentLine]);
                  currentLine = [word];
                  currentLineWidth = wordWidth;
              } else {
                  // Add word to current line
                  currentLine.push(word);
                  currentLineWidth += wordWidth;
              }
          }

          // Don't forget the last line
          if (currentLine.length > 0) {
              lines.push(currentLine);
          }

          // Calculate total height needed for all lines
          const lineHeight = 60; // Space between lines
          const totalHeight = lines.length * lineHeight;
          const startY = (height - totalHeight) / 2 + lineHeight / 2;

          // Position words for each line
          for (let lineIndex = 0; lineIndex < lines.length; lineIndex++) {
              const lineWords = lines[lineIndex];

              // Calculate total width of current line
              let lineWidth = 0;
              for (let word of lineWords) {
                  textSize(32);
                  lineWidth += textWidth(word) + 30 + 20; // word + padding + spacing
              }
              lineWidth -= 20; // Remove last spacing

              // Center the line
              const lineStartX = (width - lineWidth) / 2;
              const lineY = startY + lineIndex * lineHeight;

              let currentX = lineStartX;

              // Create word shapes for this line
              for (let word of lineWords) {
                  textSize(32);
                  const wordWidth = textWidth(word) + 30;
                  const wordX = currentX + wordWidth / 2;

                  const wordShape = new WordShape(word, wordX, lineY, words.length);
                  words.push(wordShape);

                  currentX += wordWidth + 20; // Move to next word position
              }
          }

          // Calculate bounds after creating words
          calculateSentenceBounds();
      }

      function nextSentence() {
          currentSentenceIndex = (currentSentenceIndex + 1) % poeticTexts.length;
          analyzeSentimentAndCreateSentence(poeticTexts[currentSentenceIndex]);
      }

      function regenerateColors() {
          for (let word of words) {
              word.updateColors();
          }
      }

      function setup() {
          canvas = createCanvas(windowWidth, windowHeight);
          canvas.parent(document.body);

          // Try to initialize sentiment analysis with error handling
          try {
              if (typeof ml5 !== 'undefined' && ml5.sentiment) {
                  sentiment = ml5.sentiment('movieReviews', () => {
                      console.log('ML5 Sentiment model loaded successfully');
                      modelLoaded = true;
                  });
              } else {
                  console.log('ML5 sentiment not available, using fallback analysis');
                  modelLoaded = false;
              }
          } catch (error) {
              console.log('Error initializing ML5 sentiment, using fallback:', error);
              modelLoaded = false;
          }

          // Create first sentence (will use fallback if ML5 not ready)
          setTimeout(() => {
              analyzeSentimentAndCreateSentence(poeticTexts[currentSentenceIndex]);
          }, 100);
      }

      function draw() {
          background(255);

          // Check for mouse hover over words
          hoveredWord = null;
          for (let word of words) {
              word.update();

              // Check if mouse is over this word
              const distance = dist(mouseX, mouseY, word.x, word.y);
              if (distance < max(word.shapeWidth, word.shapeHeight) / 2) {
                  hoveredWord = word;
              }

              word.display();
          }

          // Show hormone info if hovering
          updateHormoneInfo();
      }

      function updateHormoneInfo() {
          const hormoneInfoDiv = document.getElementById('hormone-info');
          const hormoneNameSpan = document.getElementById('hormone-name');
          const hormoneDescSpan = document.getElementById('hormone-description');

          if (hoveredWord && hormoneFacts[currentSentenceIndex]) {
              const fact = hormoneFacts[currentSentenceIndex];
              hormoneNameSpan.textContent = fact.hormone;
              hormoneDescSpan.textContent = fact.description;

              // Position and size the hormone info to cover the entire sentence
              const width = sentenceBounds.maxX - sentenceBounds.minX;
              const height = sentenceBounds.maxY - sentenceBounds.minY;

              hormoneInfoDiv.style.left = sentenceBounds.minX + 'px';
              hormoneInfoDiv.style.top = sentenceBounds.minY + 'px';
              hormoneInfoDiv.style.width = width + 'px';
              hormoneInfoDiv.style.height = height + 'px';
              hormoneInfoDiv.classList.add('visible');
          } else {
              hormoneInfoDiv.classList.remove('visible');
          }
      }

      function mousePressed() {
          nextSentence();
      }

      function keyPressed() {
          if (key === ' ') {
              nextSentence();
          } else if (key === 'r' || key === 'R') {
              regenerateColors();
          }
      }

      function windowResized() {
          resizeCanvas(windowWidth, windowHeight);
          // Recreate current sentence with new dimensions
          if (words.length > 0) {
              createSentence(poeticTexts[currentSentenceIndex]);
          }
      }

      function touchStarted() {
          nextSentence();
          return false;
      }
    </script>
  

</body></html>